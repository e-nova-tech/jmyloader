var donut=function(a,b){this.defaults={width:70,height:70,text_y:".35em",textSize:"20px",duration:500,transition:200,thickness:10},this.config=$.extend(!0,this.defaults,b),this.arc=null,this.foreground=null,this.background=null,this.svg=null,this.text=null,this.τ=2*Math.PI,this.$el=a;var c=this,d=this.config.width,e=this.config.height,f=this.config.text_y,g=this.config.textSize,c=this,h=Math.min(d,e)/2;this.arc=d3.svg.arc().innerRadius(h-this.config.thickness).outerRadius(h).startAngle(0),this.svg=d3.select(this.$el[0]).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+d/2+","+e/2+")"),this.background=this.svg.append("path").datum({endAngle:this.τ}).attr("class","background").attr("d",this.arc),this.foreground=this.svg.append("path").datum({endAngle:0*this.τ}).attr("class","foreground").attr("d",this.arc),this.text=c.svg.append("text").attr("text-anchor","middle").attr("dy",f),$("text",a).css("font-size",g),this.text.text(0)};donut.prototype.draw=function(a){var b=this,c=setTimeout(function(){clearTimeout(c),b.foreground.transition().duration(b.config.duration).call(b.arcTween,b.$el,b.arc,a/100*b.τ)},200)},donut.prototype.arcTween=function(a,b,c,d){a.attrTween("d",function(a){var e=d3.interpolate(a.endAngle,d);return function(d){var f=2*Math.PI;return a.endAngle=e(d),$("text",b).text(Math.round(a.endAngle/f*100)+"%"),c(a)}})},jQuery.fn.jMyLoader=function(a,b){return this.each(function(){function c(a,b){b=b||{},b.jmlId=$.jMyLoaderInstances.length;var c=f.init(a,b);return $.jMyLoaderInstances.push(c),c}function d(a){var b=a.find("div:first-child > .jml")[0];return a.find(b)}function e(a){var b=d(a);if(b){var c=b.attr("id").split("-")[1];return $.jMyLoaderInstances[c]}return null}$.jMyLoaderInstances=$.jMyLoaderInstances||Array();var f={app:null,settings:{size:300,hideAtStart:!1,initClass:"has-jmyloader",mainClass:"jmyloader",containerClass:"jmyloader-container",wrapperClass:"jmyloader-wrapper",visibleClass:"visible",theme:null,spinner:"doughnut",spinner_image:"spinner.gif",text:"<strong>Please wait</strong><br>content is loading...",jmlId:0,doughnut:{width:"auto",height:"auto",textSize:"auto",duration:500,transition:200,thickness:"auto"}},radius:0,nbItems:0,currentItem:0,init:function(a,b){if(this.app=a,this.settings=$.extend({},this.settings,b),this.radius=Math.round(this.settings.size/2),this.app.hasClass(this.settings.initClass))return this;if(this.app.is("body")||this.app.addClass(this.settings.containerClass),this.app.prepend(this.getLoaderHtml()),"doughnut"==this.settings.spinner){var c=this.settings.doughnut;"auto"==c.width&&(c.width=c.height=this.settings.size/4),"auto"==c.thickness&&(c.thickness=this.settings.size/30),"auto"==c.textSize&&(c.textSize=.08*this.settings.size+"px"),this.donut=new donut($(".spinner",this.app),c)}this.app.addClass(this.settings.initClass),$("."+this.settings.wrapperClass,this.app).width(this.settings.size).height(this.settings.size),$("."+this.settings.mainClass,this.app).width(this.settings.size).height(this.settings.size).css("right",0-this.radius).css("top",0-this.radius);var d=this.settings.size/300;return $("."+this.settings.mainClass+" p",this.app).css("font-size",100*d+"%"),this.settings.hideAtStart||this.show(),this},getLoaderHtml:function(){var a='<div class="'+this.settings.wrapperClass+(this.settings.theme?" "+this.settings.theme:"")+'"><div class="jml '+this.settings.mainClass+'" id="jml-'+this.settings.jmlId+'"><div class="spinner">'+("image"==this.settings.spinner?'<img src="css/'+this.settings.spinner_image+'" width="75">':"")+"</div><p>"+this.settings.text+"</p></div></div>";return a},isVisible:function(){return $("."+this.settings.mainClass,this.app).hasClass(this.settings.visibleClass)?!0:!1},show:function(){this.isVisible()||($("."+this.settings.mainClass,this.app).addClass(this.settings.visibleClass),$("."+this.settings.mainClass,this.app).animate({top:"+="+this.radius,right:"+="+this.radius},{duration:500}))},hide:function(){this.isVisible()&&($("."+this.settings.mainClass,this.app).animate({top:"-="+this.radius,right:"-="+this.radius},{duration:500}),$("."+this.settings.mainClass,this.app).removeClass(this.settings.visibleClass))},loaderExists:function(){return this.app.hasClass(this.settings.initClass)},setPercent:function(a){var b=this;"doughnut"==this.settings.spinner&&this.donut.draw(a),a>0&&100>a?this.show():a>=100&&("doughnut"==this.settings.spinner?setTimeout(function(){b.hide()},this.settings.doughnut.duration):this.hide())},setTotalItems:function(a){this.nbItems=a},incrementLoaded:function(a){var b=a?a:1;this.currentItem+=b,this.itemsRefresh()},addItems:function(a){this.nbItems+=a,this.itemsRefresh()},itemsRefresh:function(){var a=0;this.nbItems>0&&(a=Math.round(this.currentItem/this.nbItems*100)),this.setPercent(a)}};{if($.isPlainObject(a)||"undefined"==typeof a){var g=c($(this),a);return g}if($.jMyLoaderInstances){var h=a,i=b,j=e($(this));if(!j.app.hasClass(j.settings.initClass))return!1;switch(h){case"show":j.show();break;case"hide":j.hide();break;case"percent":j.setPercent();break;case"item-set-total":j.setTotalItems(i);break;case"item-loaded":j.incrementLoaded(i);break;case"item-add":j.addItems(i);break;case"loader-exists":return j.loaderExists()}}}})};